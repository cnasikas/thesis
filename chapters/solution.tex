%!TEX root = ../thesis.tex
\chapter{Solution}
\label{solution}

\section{Architecture}

Blockchain is used as the controller of the application. It is responsible for keeping an
audit immutable log of all actions of the participants. All interaction are being made
through the blockchain supporting data accountability and provenance tracking.

There are three main roles consisting the application: the data controller, the data processor
and the data requester. The first two are also defined in the context of the new
General Data Protection Regulation (GDPR)~\cite{gdpr} in 2016 by the European Commission.
GDPR defines another role, that of data subject-the owner of the data.
In our scheme we assume that the data controller already has permission to access the data or
she is at the same time the data subject and the data controller.

\subsection{Data Controller}

The data controller is in charge of a data set. She run on behalf of a data subject (person)
that authorises the data controller to access her personal data, with the possibility of forwarding
them to a data processor that will be responsible for processing the data on behalf of controller~\cite{DBLP:journals/corr/NeisseSF17}.

\subsection{Data Processor}

The data processor is responsible for processing data on behalf of the data requester. She listens
for requests and fulfil them on submission. Furthermore, she submits a Zero Knowledge Proof of correct computation over
a data set.

\subsection{Data Requester}

The requester can be any entity that wants a computation over a data set. It can be a research lab, a machine learning
algorithm or a university. The requester expects a proof of computation, over a specific data set, that verifies when she
gets the results.

\subsection{Flow}

\begin{enumerate}
  \item The controller encrypts a data set with a symmetric key and saves the cipher-text to a database
  \item The controller encrypts the symmetric key with the public key of the processor
  \item The requester makes a request of process over some data
  \item The processor process the data on behalf of the request and submits the result of the computation on the
  blockchain along with a Zero Knowledge Proof (ยง~\ref{zkp}) of the correctness of the computation.
  \item The requester gets the results and verifies the proof.
\end{enumerate}

\begin{figure}[ht!]
  \begin{tikzpicture}[
        database/.style={
        cylinder,
        shape border rotate=90,
        aspect=0.5,
        draw
      },
      txt/.style={
      }
    ]

    \node[draw,rectangle,minimum width=\textwidth, minimum height=1cm,anchor=west] (blockchain) at (0,0){Blockchain};

    \begin{scope}[node distance=4cm]
      \node[draw, minimum height=1cm, minimum width=4cm, anchor=west] (owner) at (0,-5) {Data Controller};
      \node[database] (db) [below right=of owner] {Database};
      \draw[<->] (owner) -- (db);
      \draw[<-] ([xshift=-1em]owner.north) -- ([xshift=-1em]2,-0.5);
      \draw[->] ([xshift=1em]owner.north) -- ([xshift=1em]2,-0.5);
    \end{scope}

    \node[txt] (enc_db) [below=of owner,yshift=-1.5em, xshift=3em] {$Enc_k(data)$};
    \node[txt] (enc_key) [above=of owner, xshift=6.5em, yshift=1em] {$Enc_{pk_P}(k, metadata)$};

    \begin{scope}
      \node[draw, minimum height=1cm, minimum width=4cm, anchor=west] (processor) at (0,5) {Data Processor};
      \draw[<-] ([xshift=-1em]processor.south) -- ([xshift=-1em]2,0.5);
      \draw[->] ([xshift=1em]processor.south) -- ([xshift=1em]2,0.5);
    \end{scope}

    \node[txt] (enc_db) [below=of processor,yshift=-1.5em, xshift=6em] {$Enc_{pk_R}(result, \pi)$};

    \begin{scope}
      \node[draw, minimum height=1cm, minimum width=4cm, anchor=east] (requester) at (\textwidth,-5) {Requester};
      \draw[->] ([xshift=-1em]requester.north) -- ([xshift=-1em]14.45,-0.5);
      \draw[<-] ([xshift=1em]requester.north) -- ([xshift=1em]14.45,-0.5);
    \end{scope}

    \node[txt] (enc_db) [above left=of requester, xshift=5.5em] {$Request(pk_R, pred)$};
    \node[txt] (enc_db) [above right=of requester, xshift=-5.5em] {$Verify_{vk}(\pi)$};

  \end{tikzpicture}
  \caption{Architecture}
  \label{fig:architecture}
\end{figure}
